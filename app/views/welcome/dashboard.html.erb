<!DOCTYPE html>
<html>
  <head>
  <title>Dashboard</title>
</head>

<style>
  .ui-page, body {
    background-position-x: -150px;
    background-size: 500px;
    background-image: url(<%= asset_path 'login_background.jpg' %>);
    background-attachment: fixed;
  }
</style>

<body>
<div data-role="page" id="dashboard">
  <div data-role="header">
    <h1>Dashboard</h1>
  </div><!-- /header -->
  <% if flash[:notice] %>
   <div id = "notice" class = "notice">
    <%= flash[:notice] %>
  </div>
<% end %>
  <div data-role="collapsible-set">
    <div data-role="collapsible" data-collapsed="true">
      <h4>My Events</h4>
        <ul data-role="listview">
          <% now = DateTime.now().in_time_zone(@zone) %>
          <% @user_events.each do |a| %>
            <% if a.event.start_date_and_time.in_time_zone(@zone) < now %>
              <li class = "attendance-now">
            <% elsif a.event.start_date_and_time.in_time_zone(@zone).to_date == now.to_date %>
              <li class = "attendance-today">
            <% elsif a.event.start_date_and_time.in_time_zone(@zone).to_date == now.to_date+1.day %>
              <li class = "attendance-tomorrow">
            <% else %>
                <li class = "attendance-future">
            <% end %>
              <%=link_to "#{a.event.name}: #{a.commitment_status}", a.event, data:{ajax: "false"} %></li>
          <%end%>
          <%= "You have no events"  unless @user_events.length > 0 %>
      </ul>
    </div>


    <% unless session[:is_parent?] %>
    <div data-role="collapsible" data-collapsed="true">
      <h4>My Nudges</h4>
        <ul data-role="listview">
    <div data-role="collapsible" data-collapsed="false" id = "incoming_nudges">
      <h4>Incoming Nudges (<%=@nudges_in.length%>)</h4>
      <ul data-role="listview">
      <% @nudges_in.each do |n| %>
      <li>
        <%=link_to "#{n.nudger.username} wants to go to #{n.event.name} with you", n.event, data: {ajax: "false"}%>
      </li>
      <%end%>
    </div>
    <div data-role="collapsible" data-collapsed="false" id = "outgoing_nudges">
      <h4>Outgoing Nudges (<%=@nudges_out.length%>)</h4>
      <ul data-role="listview">
      <% @nudges_out.each do |n| %>
      <li>
        <%=link_to "You want to go to #{n.event.name} with #{n.nudgee.username}",  n.event, data: {ajax: "false"}%>
      </li>
      <%end%>
    </ul>
    </div>
    </div>
    <% end %>


    <div data-role="collapsible" data-collapsed="true">
      <h4>Trending</h4>
      <ul data-role="listview">
        <% @trending_events.each do |event| %>
          <li><%= link_to "#{event.name}: #{pluralize(event.attendees.count, 'person')} going", event, data: {ajax: "false"} %></li>
        <% end %>
      </ul>
    </div>

    <div data-role="collapsible" data-collapsed="true">
      <h4>Find Events</h4>
        <ul data-role="listview">
          <li><a href="events?time=today", data-ajax="false">Today</a></li>
          <li><a href="events?time=tomorrow", data-ajax="false">Tomorrow</a></li>
          <li><a href="events?time=this_week", data-ajax="false">This Week</a></li>
      </ul>
    </div>


  <div data-role="footer" data-id="foo1" data-position="fixed">
    <%= render "shared/navbar" %>
  </div>

</div><!-- /page -->

<div data-role="page" id="topicList" data-quicklinks="true">

  <div data-role="header" class="jqm-header">
  <h1>Index</h1>
  <a href="#myPanel" class="ui-btn ui-shadow ui-corner-all ui-icon-bars ui-btn-icon-notext"></a>
  </div><!-- /header -->

  <div role="main" class="ui-content jqm-content">

    <<ul data-role="listview" type="a" id="options">
      <li></li>
    </ul>

  </div><!-- /panel -->

  <div data-role="header" data-theme="a">
       <h1>Events</h1>
  </div>
    <!-- /header -->

  <div data-role="content">
      <ul data-role="listview" data-inset="true" id="event-list" data-autodividers="true" data-filter="true" data-filter-placeholder="Search events..."></ul>
  </div> <!-- /content -->

<!-- Here are a bunch of panels at the end, just before the close page tag  -->

  <!-- leftpanel1  -->
  <div data-role="panel" id="myPanel" data-position="left" data-display="reveal" data-theme="a">

        <h2>Catagories</h2>

      <div>
        <div class="toggle-option" id="football">
          <label class="switch-label" for="flip-3">Football</label>
          <select name="flip-3" id="flip-3" data-role="flipswitch" data-mini="false">
            <option value="off">Off</option>
            <option value="on" selected="selected">On</option>
         </select>
        </div>
        <div class="toggle-option" id="camp">
          <label class="switch-label" for="flip-3">Camp</label>
          <select name="flip-3" id="flip-3" data-role="flipswitch" data-mini="false">
            <option value="off">Off</option>
            <option value="on" selected="selected">On</option>
          </select>
        </div>
        <div class="toggle-option" id="recreational">
          <label class="switch-label" for="flip-3">Recreational</label>
          <select name="flip-3" id="flip-3" data-role="flipswitch" data-mini="false">
            <option value="off">Off</option>
            <option value="on" selected="selected">On</option>
          </select>
        </div>
        <div class="toggle-option" id="basketball">
          <label class="switch-label" for="flip-3">Basketball</label>
          <select name="flip-3" id="flip-3" data-role="flipswitch" data-mini="false">
            <option value="off">Off</option>
            <option value="on" selected="selected">On</option>
          </select>
        </div>
        <div class="toggle-option" id="tennis">
          <label class="switch-label" for="flip-3">Tennis</label>
          <select name="flip-3" id="flip-3" data-role="flipswitch" data-mini="false">
            <option value="off">Off</option>
            <option value="on" selected="selected">On</option>
          </select>
        </div>
        <div class="toggle-option" id="aquatic">
          <label class="switch-label" for="flip-3">Aquatic</label>
          <select name="flip-3" id="flip-3" data-role="flipswitch" data-mini="false">
            <option value="off">Off</option>
            <option value="on" selected="selected">On</option>
          </select>
        </div>
        <div class="toggle-option" id="gymnastics">
          <label class="switch-label" for="flip-3">Gymnastics</label>
          <select name="flip-3" id="flip-3" data-role="flipswitch" data-mini="false">
            <option value="off">Off</option>
            <option value="on" selected="selected">On</option>
          </select>
        </div>
        <div class="toggle-option" id="fitness">
          <label class="switch-label" for="flip-3">Fitness</label>
          <select name="flip-3" id="flip-3" data-role="flipswitch" data-mini="false">
            <option value="off">Off</option>
            <option value="on" selected="selected">On</option>
          </select>
        </div>
        <div class="toggle-option" id="other">
          <label class="switch-label" for="flip-3">Other</label>
          <select name="flip-3" id="flip-3" data-role="flipswitch" data-mini="false">
            <option value="off">Off</option>
            <option value="on" selected="selected">On</option>
          </select>
        </div>

      </div>
  </div><!-- /leftpanel1 -->

<script>

proper_url = window.location.origin.concat("/dashboard")
if (window.location.href != proper_url){
  window.location.replace(proper_url)
}

var eventsJson = null
$.ajax({
  method: "get",
  url: "/events/all",
  dataType: "json",
  success: function(data) {
    eventsJson = data;
    refresh();
  }
})


var footballVal = 'on', campVal = 'on', recreationalVal = 'on', gymnasticsVal = "on", basketballVal = "on", tennisVal = "on", aquaticVal = "on", fitnessVal = "on", otherVal = "on", filteredIds = [];

var eventsType = ['Football', 'Camp', 'Recreational', 'Basketball', 'Gymnastics', 'Tennis', 'Aquatic', 'Fitness', 'Other'];
var filteredEvents = [];
setTimeout(refresh, 1000);
setTimeout(refresh, 3000);
setTimeout(refresh, 2000);
setTimeout(refresh, 2000);

// refresh()
// var fixedJson = JSON.parse(originalJson);
// var eventsJson = originalJson.events;

//football
$('#football').change(function(){
  if(footballVal==('on')) {
    for(var i = 0; i < eventsType.length; i++){
      if (eventsType[i] === "Football") {
        eventsType.splice(i, 1);
      }
    }
    footballVal = 'off'
  } else {
    eventsType.push("Football");
    footballVal = 'on'
  }
  refresh();
});

//camp
$('#camp').change(function(){
  if(campVal==('on')) {
    for(var i = 0; i < eventsType.length; i++){
      if (eventsType[i] === "Camp") {
        eventsType.splice(i, 1);
      }
    }
    campVal = 'off'
  } else {
    eventsType.push("Camp");
    campVal = 'on'
  }
  refresh();
});

//recreational
$('#recreational').change(function(){
  if(recreationalVal==('on')) {
    for(var i = 0; i < eventsType.length; i++){
      if (eventsType[i] === "Recreational") {
        eventsType.splice(i, 1);
      }
    }
    recreationalVal = 'off'
  } else {
    eventsType.push("Recreational");
    recreationalVal = 'on'
  }
  refresh();
});

//basketball
$('#basketball').change(function(){
  if(basketballVal==('on')) {
    for(var i = 0; i < eventsType.length; i++){
      if (eventsType[i] === "Basketball") {
        eventsType.splice(i, 1);
      }
    }
    basketballVal = 'off'
  } else {
    eventsType.push("Basketball");
    basketballVal = 'on'
  }
  refresh();
});

//tennis
$('#tennis').change(function(){
  if(tennisVal==('on')) {
    for(var i = 0; i < eventsType.length; i++){
      if (eventsType[i] === "Tennis") {
        eventsType.splice(i, 1);
      }
    }
    tennisVal = 'off'
  } else {
    eventsType.push("Tennis");
    tennisVal = 'on'
  }
  refresh();
});

//aquatic
$('#aquatic').change(function(){
  if(aquaticVal==('on')) {
    for(var i = 0; i < eventsType.length; i++){
      if (eventsType[i] === "Aquatic") {
        eventsType.splice(i, 1);
      }
    }
    aquaticVal = 'off'
  } else {
    eventsType.push("Aquatic");
    aquaticVal = 'on'
  }
  refresh();
});

//gymnastics
$('#gymnastics').change(function(){
  if(gymnasticsVal==('on')) {
    for(var i = 0; i < eventsType.length; i++){
      if (eventsType[i] === "Gymnastics") {
        eventsType.splice(i, 1);
      }
    }
    gymnasticsVal = 'off'
  } else {
    eventsType.push("Gymnastics");
    gymnasticsVal = 'on'
  }
  refresh();
});

//fitness
$('#fitness').change(function(){
  if(fitnessVal==('on')) {
    for(var i = 0; i < eventsType.length; i++){
      if (eventsType[i] === "Fitness") {
        eventsType.splice(i, 1);
      }
    }
    fitnessVal = 'off'
  } else {
    eventsType.push("Fitness");
    fitnessVal = 'on'
  }
  refresh();
});

//other
$('#other').change(function(){
  if(otherVal==('on')) {
    for(var i = 0; i < eventsType.length; i++){
      if (eventsType[i] === "Other") {
        eventsType.splice(i, 1);
      }
    }
    otherVal = 'off'
  } else {
    eventsType.push("Other");
    otherVal = 'on'
  }
  refresh();
});

function refresh() {
  filteredEvents = [];
  for (var i = 0; i < eventsType.length; i++)
    {
      for (var j = 0; j < eventsJson.length; j++)
      {
        if (eventsType[i] === eventsJson[j].event_type)
        {
          filteredEvents.push(eventsJson[j].name);
          filteredIds.push(eventsJson[j].id);
        }
      }
    }

    filteredEvents.sort();

    var output = '';
    $.each(filteredEvents, function (index, value) {
      output += '<li><a href="events/' + filteredIds[index] + '">' + value + '</a></li>';
    });
    $('#event-list').html(output).listview().listview("refresh");
}
</script>

</div><!-- /page -->
</body>

</html>
